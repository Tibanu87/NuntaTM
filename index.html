<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Poze de la Nuntă</title>
  <script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.0"></script>
  <style>
    /* ... aici păstrezi tot CSS-ul tău original ... */
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>💕 Poze Nuntă Maria si Tiberiu 💕</h1>
      <p>Împărtășește momentele frumoase cu noi adăugând poze cu voi!💕❤️</p>
    </div>
    
    <div class="content">
      <div id="welcomeForm" class="welcome-form">
        <h3>Bună ziua! Vă rugăm să vă introduceți numele:</h3>
        <div class="form-group">
          <label for="guestName">Numele dumneavoastră:</label>
          <input type="text" id="guestName" placeholder="ex: Ana și Mihai Popescu">
        </div>
        <button class="btn" onclick="setGuestName()">Confirmă</button>
      </div>

      <div id="mainApp" class="hidden">
        <div id="welcomeMessage" class="welcome-message">
          <strong>Bun venit!</strong> Acum puteți adăuga poze și vedea pozele celorlalți invitați.
        </div>

        <div class="photo-upload">
          <h3>📸 Adaugă o poză nouă</h3>
          <div class="form-group">
            <label for="photoInput">Selectează poza:</label>
            <input type="file" id="photoInput" accept="image/*" multiple>
          </div>
          <button class="btn" onclick="uploadPhotos()">Încarcă Pozele</button>
        </div>

        <div class="gallery-section">
          <h3 style="color: #8b7355; margin-bottom: 20px;">📷 Galeria Foto</h3>
          <div id="photoGallery" class="gallery"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===============================
    // CONFIGURARE APPWRITE
    // ===============================
    const client = new Appwrite.Client()
      .setEndpoint('https://cloud.appwrite.io/v1') // endpoint Appwrite Cloud
      .setProject('68b1d9c5002d64986cc4'); // Project ID-ul tău

    const storage = new Appwrite.Storage(client);
    const bucketId = '68b1da9b002d5fd5fe09'; // Bucket ID-ul tău

    // ===============================
    // VARIABILE LOCALE
    // ===============================
    let currentGuest = '';
    let photos = [];
    let currentPhotoIndex = 0;

    // ===============================
    // LOGICA APLICAȚIEI
    // ===============================
    function setGuestName() {
      const nameInput = document.getElementById('guestName');
      const name = nameInput.value.trim();
      if (name === '') {
        alert('Vă rugăm să introduceți numele!');
        return;
      }
      currentGuest = name;
      document.getElementById('welcomeForm').classList.add('hidden');
      document.getElementById('mainApp').classList.remove('hidden');
      document.getElementById('welcomeMessage').innerHTML =
        `<strong>Bun venit, ${currentGuest}!</strong> Acum puteți adăuga poze și vedea pozele celorlalți invitați.`;
    }

    async function uploadPhotos() {
      const photoInput = document.getElementById('photoInput');
      const files = photoInput.files;
      if (files.length === 0) {
        alert('Selectează cel puțin o poză!');
        return;
      }

      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        try {
          const response = await storage.createFile(
            bucketId,
            Appwrite.ID.unique(),
            file
          );

          // Creează URL public pentru vizualizare
          const fileUrl =
            client.config.endpoint +
            '/storage/buckets/' + bucketId +
            '/files/' + response.$id +
            '/view?project=' + client.config.project;

          photos.unshift({
            id: Date.now() + i,
            src: fileUrl,
            guestName: currentGuest,
            uploadTime: new Date().toLocaleString('ro-RO'),
            originalName: file.name
          });
        } catch (error) {
          console.error("Eroare upload:", error);
          alert("Eroare la încărcarea fișierului: " + file.name);
        }
      }

      displayPhotos();
      alert(`${files.length} poze au fost încărcate cu succes în Appwrite!`);
      photoInput.value = '';
    }

    function displayPhotos() {
      const gallery = document.getElementById('photoGallery');
      if (photos.length === 0) {
        gallery.innerHTML =
          '<p style="text-align: center; color: #999; grid-column: 1/-1;">Încă nu au fost încărcate poze. Fiți primul care adaugă o poză!</p>';
        return;
      }
      gallery.innerHTML = photos.map((photo, index) => `
        <div class="photo-item" onclick="openModal(${index})">
          <img src="${photo.src}" alt="Poză de la nuntă" loading="lazy">
          <div class="photo-info">
            <div class="guest-name">${photo.guestName}</div>
            <div class="upload-time">${photo.uploadTime}</div>
          </div>
        </div>
      `).join('');
    }

    // ===============================
    // MODAL FOTO (dacă vrei să-l păstrezi)
    // ===============================
    function openModal(photoIndex) {
      currentPhotoIndex = photoIndex;
      const photo = photos[photoIndex];
      alert(`Poză de la ${photo.guestName}, încărcată la ${photo.uploadTime}`);
    }
  </script>
</body>
</html>
